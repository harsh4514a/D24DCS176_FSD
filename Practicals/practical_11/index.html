<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chatter ‚Äî Minimal Social Chat</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0b1020;
      --panel: #121735;
      --muted: #93a5fd;
      --text: #e8eeff;
      --accent: #6c7cff;
      --accent-2: #16db65;
      --danger: #ff5c7a;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: linear-gradient(120deg, #0b1020, #141a3f);
      color: var(--text);
      font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    .app {
      display: grid;
      grid-template-columns: 280px 1fr;
      min-height: 100vh;
    }

    .sidebar {
      background: rgba(18, 23, 53, .7);
      backdrop-filter: blur(8px);
      border-right: 1px solid rgba(255, 255, 255, .08);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
    }

    .logo .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent-2);
      box-shadow: 0 0 18px var(--accent-2);
    }

    .card {
      background: rgba(255, 255, 255, .04);
      border: 1px solid rgba(255, 255, 255, .08);
      border-radius: 16px;
    }

    .user-card {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
    }

    .user-card img {
      width: 36px;
      height: 36px;
      border-radius: 50%;
    }

    .btn,
    button,
    input,
    textarea {
      font-family: inherit;
    }

    .btn {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, .15);
      background: rgba(255, 255, 255, .05);
      color: var(--text);
      cursor: pointer;
    }

    .btn.primary {
      background: var(--accent);
      border-color: transparent;
    }

    .btn.ghost {
      background: transparent;
      border-color: rgba(255, 255, 255, .1);
    }

    .btn.full {
      width: 100%;
    }

    .muted {
      color: #a8b0d6;
      font-size: .9rem;
    }

    .search {
      display: flex;
      gap: 8px;
      padding: 10px;
    }

    .search input {
      flex: 1;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(0, 0, 0, .2);
      color: var(--text);
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 10px;
    }

    .nav .item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
    }

    .nav .item.active,
    .nav .item:hover {
      background: rgba(255, 255, 255, .08);
    }

    .chats {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 8px;
      overflow: auto;
      max-height: 300px;
    }

    .chat-row {
      display: grid;
      grid-template-columns: 46px 1fr auto;
      gap: 10px;
      padding: 10px;
      border-radius: 12px;
      cursor: pointer;
    }

    .chat-row:hover {
      background: rgba(255, 255, 255, .06);
    }

    .chat-row img {
      width: 46px;
      height: 46px;
      border-radius: 50%;
    }

    .chat-row .name {
      font-weight: 600;
    }

    .chat-row .last {
      color: #b7bde3;
      font-size: .92rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .main {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, .08);
      background: rgba(18, 23, 53, .6);
      backdrop-filter: blur(8px);
    }

    .topbar .title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .content {
      display: grid;
      grid-template-rows: 1fr auto;
      gap: 0;
      height: calc(100vh - 56px);
    }

    .messages {
      padding: 14px;
      overflow: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .bubble {
      position: relative;
      max-width: 70%;
      padding: 10px 12px;
      border-radius: 14px;
      line-height: 1.35;
    }

    .me {
      align-self: flex-end;
      background: linear-gradient(135deg, var(--accent), #8e99ff);
    }

    .you {
      align-self: flex-start;
      background: rgba(255, 255, 255, .08);
    }

    .msg-controls {
      
      display: none;
      position: absolute;
      top: 4px;
      right: 30px;
      gap: 6px;
      background: red;
      border-radius: 30px;
    }

    .bubble:hover .msg-controls {
      display: flex;
    }

    .msg-btn {
      cursor: pointer;
      background: rgba(0, 0, 0, 0.3);
      color: #fff;
      border: none;
      padding: 2px 6px;
      font-size: 14px;
      border-radius: 3px;
    }

    .composer {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      padding: 12px;
      border-top: 1px solid rgba(255, 255, 255, .08);
      background: rgba(0, 0, 0, .15);
    }

    .composer textarea {
      resize: none;
      height: 50px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(0, 0, 0, .2);
      color: var(--text);
    }

    .auth {
      max-width: 420px;
      margin: 8vh auto;
      padding: 20px;
    }

    .auth .group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin: 8px 0;
    }

    .auth input {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(0, 0, 0, .2);
      color: var(--text);
    }

    .switch {
      margin-top: 6px;
      font-size: .95rem;
    }

    .empty {
      display: grid;
      place-items: center;
      height: 100%;
      color: #aeb7e9;
    }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, .08);
      border: 1px dashed rgba(255, 255, 255, .18);
    }

    @media(max-width: 980px) {
      .app {
        grid-template-columns: 1fr;
      }

      .sidebar {
        position: fixed;
        z-index: 10;
        inset: 0 30% 0 0;
        transform: translateX(-100%);
        transition: 0.25s;
      }

      .sidebar.open {
        transform: none;
      }

      .topbar .menu {
        display: inline-block;
      }

      .topbar .menu button {
        font-size: 20px;
      }

      .topbar .title {
        gap: 8px;
      }
    }

    @media(min-width: 981px) {
      .topbar .menu {
        display: none;
      }
    }
  </style>
</head>

<body>

  <div id="authView" class="auth card" hidden>
    <div class="logo" style="margin-bottom:12px"><span class="dot"></span> <span>Chatter</span></div>
    <h2 id="authTitle">Create account</h2>
    <div class="group"><label>Name</label><input id="nameInput" placeholder="Your Name" /></div>
    <div class="group"><label>Email</label><input id="emailInput" type="email" placeholder="you@example.com" /></div>
    <div class="group"><label>Password</label><input id="passwordInput" type="password" placeholder="********" /></div>
    <div class="group"><button id="authSubmit" class="btn primary full">Sign up</button></div>
    <div class="group"><button id="googleBtn" class="btn full">Continue with Google</button></div>
    <div id="authMsg" class="muted" style="margin-top:8px"></div>
    <div class="switch" id="authSwitch">Already have an account? <a href="#" id="toLogin">Sign in</a></div>
  </div>

  <div id="appView" class="app" hidden>
    <aside class="sidebar" id="sidebar">
      <div class="logo"><span class="dot"></span> Chatter</div>
      <div class="card user-card">
        <img id="meAvatar" alt="avatar" />
        <div>
          <div id="meName" style="font-weight:600">‚Äî</div>
          <div id="meEmail" class="muted">‚Äî</div>
        </div>
      </div>
      <div class="card search">
        <input id="userSearch" placeholder="Search users by name/email" />
        <button id="inviteBtn" class="btn">+</button>
      </div>
      <div class="nav card">
        <div id="navChats" class="item active">üí¨ Chats</div>
        <div id="navPeople" class="item">üë• People</div>
        <div id="navProfile" class="item">üôç Profile</div>
        <div id="navLogout" class="item">üö™ Logout</div>
      </div>
      <div class="card">
        <div class="muted" style="padding: 0.5rem;">Recent chats</div>
        <div id="recentList" class="chats"></div>
      </div>
      <div id="peopleView" class="card chats" style="display:none; max-height:300px; overflow-y:auto;"></div>
      <div id="profileView" class="card" style="display:none; padding:1rem;">
        <img id="profileAvatar" style="width:60px; height:60px; border-radius:50%;" />
        <div id="profileName" style="font-weight:600; margin-top: .5rem;"></div>
        <div id="profileEmail" class="muted"></div>
      </div>
      <div class="muted" style="padding:1rem;text-align:center;">Built with Firebase</div>
    </aside>
    <main class="main">
      <div class="topbar">
        <div class="title">
          <button id="toggleSidebar" class="btn ghost">‚ò∞</button>
          <strong id="chatTitle" style="margin-left:.5rem;">Welcome</strong>
          <button id="deleteChatBtn" class="btn ghost" style="margin-left:12px; font-size:10px; display:none;">Delete
            Chat</button>
          <div id="chatSub" class="muted" style="font-size:0.9rem;">Select a conversation or find people to start
            chatting.</div>
        </div>
      </div>
      <div class="content">
        <div id="messages" class="messages"></div>
        <div id="composer" class="composer" style="display:none;">
          <textarea id="messageInput" placeholder="Type a message"></textarea>
          <button id="sendBtn" class="btn primary">Send</button>
        </div>
        <div id="emptyState" class="empty">
          <div class="pill">No chat selected</div>
        </div>
      </div>
    </main>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut,
      updateProfile,
      GoogleAuthProvider,
      signInWithPopup
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      addDoc,
      collection,
      query,
      getDocs,
      serverTimestamp,
      onSnapshot,
      orderBy,
      updateDoc,
      deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAIYXwSufm3kHkuzALeF7yqVfQILRRLLU4",
      authDomain: "practical-11-eda72.firebaseapp.com",
      projectId: "practical-11-eda72",
      storageBucket: "practical-11-eda72.firebasestorage.app",
      messagingSenderId: "662094062639",
      appId: "1:662094062639:web:06cb2b6e3d0546a2ee52da",
      measurementId: "G-0QEKJQZKKF",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const authView = document.getElementById("authView"),
      appView = document.getElementById("appView"),
      authTitle = document.getElementById("authTitle"),
      nameInput = document.getElementById("nameInput"),
      emailInput = document.getElementById("emailInput"),
      passwordInput = document.getElementById("passwordInput"),
      authSubmit = document.getElementById("authSubmit"),
      googleBtn = document.getElementById("googleBtn"),

      meName = document.getElementById("meName"),
      meEmail = document.getElementById("meEmail"),
      meAvatar = document.getElementById("meAvatar"),

      recentList = document.getElementById("recentList"),
      peopleView = document.getElementById("peopleView"),
      profileView = document.getElementById("profileView"),
      profileAvatar = document.getElementById("profileAvatar"),
      profileName = document.getElementById("profileName"),
      profileEmail = document.getElementById("profileEmail"),

      userSearch = document.getElementById("userSearch"),
      inviteBtn = document.getElementById("inviteBtn"),

      navChats = document.getElementById("navChats"),
      navPeople = document.getElementById("navPeople"),
      navProfile = document.getElementById("navProfile"),
      navLogout = document.getElementById("navLogout"),

      chatTitle = document.getElementById("chatTitle"),
      chatSub = document.getElementById("chatSub"),

      messages = document.getElementById("messages"),
      composer = document.getElementById("composer"),
      messageInput = document.getElementById("messageInput"),
      sendBtn = document.getElementById("sendBtn"),

      emptyState = document.getElementById("emptyState"),
      sidebar = document.getElementById("sidebar"),
      toggleSidebar = document.getElementById("toggleSidebar"),
      deleteChatBtn = document.getElementById("deleteChatBtn");

    let isSignup = true,
      activeChatId = null,
      messagesUnsub = null;

    function setAuthMode(signup) {
      isSignup = signup;
      authTitle.textContent = signup ? "Create account" : "Welcome back";
      authSubmit.textContent = signup ? "Sign up" : "Sign in";
      nameInput.parentElement.style.display = signup ? "flex" : "none";
      document.getElementById("authSwitch").innerHTML = signup
        ? 'Already have an account? <a href="#" id="toLogin">Sign in</a>'
        : "Don't have an account? <a href=\"#\" id=\"toSignup\">Create one</a>";
      const toLogin = document.getElementById("toLogin");
      const toSignup = document.getElementById("toSignup");
      if (toLogin) toLogin.addEventListener("click", e => { e.preventDefault(); setAuthMode(false); });
      if (toSignup) toSignup.addEventListener("click", e => { e.preventDefault(); setAuthMode(true); });
    }

    setAuthMode(true);

    googleBtn.addEventListener("click", async () => {
      try {
        const cred = await signInWithPopup(auth, provider);
        await ensureUserDoc(cred.user);
      } catch (e) {
        alert(e.message);
      }
    });

    authSubmit.addEventListener("click", async () => {
      const email = emailInput.value.trim();
      const pass = passwordInput.value.trim();
      try {
        if (isSignup) {
          const name = nameInput.value.trim() || email.split("@")[0];
          const cred = await createUserWithEmailAndPassword(auth, email, pass);
          await updateProfile(cred.user, { displayName: name, photoURL: `https://api.dicebear.com/api/identicon/${name}.svg` });
          await ensureUserDoc(cred.user);
        } else {
          const cred = await signInWithEmailAndPassword(auth, email, pass);
          await ensureUserDoc(cred.user);
        }
      } catch (e) {
        alert(e.message);
      }
    });

    navLogout.addEventListener("click", () => signOut(auth));
    toggleSidebar.addEventListener("click", () => sidebar.classList.toggle("open"));
    navChats.addEventListener("click", () => showSection("chats"));
    navPeople.addEventListener("click", () => { showSection("people"); loadPeople(); });
    navProfile.addEventListener("click", () => { showSection("profile"); loadProfile(); });

    function showSection(section) {
      navChats.classList.toggle("active", section === "chats");
      navPeople.classList.toggle("active", section === "people");
      navProfile.classList.toggle("active", section === "profile");
      recentList.parentElement.style.display = section == "chats" ? "block" : "none";
      peopleView.style.display = section == "people" ? "block" : "none";
      profileView.style.display = section == "profile" ? "block" : "none";
    }

    onAuthStateChanged(auth, user => {
      if (user) {
        authView.style.display = "none";
        appView.style.display = "grid";
        meName.textContent = user.displayName || 'Anonymous';
        meEmail.textContent = user.email || '';
        meAvatar.src = user.photoURL || `https://api.dicebear.com/api/identicon/${user.uid}.svg`;
        loadRecentChats(user.uid);
        showSection("chats");
      } else {
        authView.style.display = "block";
        appView.style.display = "none";
        setAuthMode(false);
      }
    });

    async function ensureUserDoc(user) {
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        await setDoc(ref, {
          uid: user.uid,
          name: user.displayName || "Anonymous",
          email: user.email,
          photoURL: user.photoURL || "",
          createdAt: serverTimestamp()
        });
      }
    }

    userSearch.addEventListener("input", debounce(async e => {
      const term = e.target.value.toLowerCase();
      const me = auth.currentUser;
      if (!me) return;
      const usersRef = collection(db, "users");
      const qSnapshot = await getDocs(usersRef);
      let filtered = qSnapshot.docs.map(d => d.data()).filter(u => u.uid !== me.uid);
      if (term) filtered = filtered.filter(u => (u.name && u.name.toLowerCase().includes(term)) || (u.email && u.email.toLowerCase().includes(term)));
      renderPeople(filtered);
    }, 300));

    async function loadPeople() {
      const me = auth.currentUser;
      if (!me) return;
      const usersRef = collection(db, "users");
      const qSnapshot = await getDocs(usersRef);
      const users = qSnapshot.docs.map(d => d.data()).filter(u => u.uid !== me.uid);
      renderPeople(users);
    }

    function renderPeople(people) {
      peopleView.innerHTML = "";
      people.forEach(p => {
        const row = document.createElement("div");
        row.className = "chat-row";
        row.innerHTML = `
      <img src="${p.photoURL || `https://api.dicebear.com/api/identicon/${p.uid}.svg`}" />
      <div>
        <div class="name">${escapeHtml(p.name || "User")}</div>
        <div class="muted">${escapeHtml(p.email)}</div>
      </div>
      `;
        row.addEventListener("click", () => startChatWith(p.uid));
        peopleView.appendChild(row);
      });
    }

    function loadProfile() {
      const me = auth.currentUser;
      if (!me) return;
      profileAvatar.src = me.photoURL || `https://api.dicebear.com/api/identicon/${me.uid}.svg`;
      profileName.textContent = me.displayName || 'Anonymous';
      profileEmail.textContent = me.email || '';
    }

    async function loadRecentChats(uid) {
      const ucRef = collection(db, "userChats", uid, "items");
      const q = query(ucRef, orderBy("updatedAt", "desc"));
      onSnapshot(q, querySnapshot => {
        recentList.innerHTML = "";
        querySnapshot.forEach(docSnap => {
          const c = docSnap.data();
          const row = document.createElement("div");
          row.className = "chat-row";
          row.dataset.chatId = c.chatId;
          row.innerHTML = `
          <img src="${c.photoURL || `https://api.dicebear.com/api/identicon/${c.otherUid}.svg`}" />
          <div>
            <div class="name">${escapeHtml(c.otherName || "User")}</div>
            <div class="muted">${escapeHtml(c.lastMessage || "")}</div>
          </div>
          <div class="muted">${timeAgo(c.updatedAt?.toDate() || new Date())}</div>
        `;
          row.addEventListener("click", () => openChat(c.chatId, c));
          recentList.appendChild(row);
        });
      });
    }

    function composeChatId(a, b) {
      return a < b ? `${a}_${b}` : `${b}_${a}`;
    }

    async function startChatWith(otherUid) {
      const me = auth.currentUser;
      if (!me || otherUid === me.uid) return;
      const chatId = composeChatId(me.uid, otherUid);
      const chatRef = doc(db, "chats", chatId);
      const chatSnap = await getDoc(chatRef);
      if (!chatSnap.exists()) await setDoc(chatRef, { chatId, participants: [me.uid, otherUid], createdAt: serverTimestamp(), updatedAt: serverTimestamp(), lastMessage: "" });
      const otherUser = await getDoc(doc(db, "users", otherUid));
      const meUser = await getDoc(doc(db, "users", me.uid));
      await setDoc(doc(db, "userChats", me.uid, "items", chatId), {
        chatId,
        otherUid,
        otherName: otherUser.data()?.name || "User",
        photoURL: otherUser.data()?.photoURL || "",
        lastMessage: "",
        updatedAt: serverTimestamp(),
      }, { merge: true });
      await setDoc(doc(db, "userChats", otherUid, "items", chatId), {
        chatId,
        otherUid: me.uid,
        otherName: meUser.data()?.name || "User",
        photoURL: meUser.data()?.photoURL || "",
        lastMessage: "",
        updatedAt: serverTimestamp(),
      }, { merge: true });
      openChat(chatId, otherUser.data());
    }

    function openChat(chatId, other) {
      activeChatId = chatId;
      chatTitle.textContent = other?.name || "Chat";
      chatSub.textContent = other?.email || "";
      emptyState.style.display = "none";
      composer.style.display = "grid";
      messages.innerHTML = "";
      sidebar.classList.remove("open");
      deleteChatBtn.style.display = chatId ? "inline-block" : "none";

      if (messagesUnsub) messagesUnsub();

      const msgsRef = collection(db, "chats", chatId, "messages");
      const q = query(msgsRef, orderBy("createdAt", "asc"));
      messagesUnsub = onSnapshot(q, snapshot => {
        messages.innerHTML = "";
        snapshot.forEach(docSnap => {
          const msg = docSnap.data();
          const isMe = msg.senderId === auth.currentUser.uid;
          const msgDiv = document.createElement("div");
          msgDiv.className = `bubble ${isMe ? "me" : "you"}`;
          msgDiv.textContent = msg.text;
          msgDiv.style.position = "relative";

          if (isMe) {
            const controls = document.createElement("div");
            controls.className = "msg-controls";
            const deleteBtn = document.createElement("button");
            deleteBtn.className = "msg-btn";
            deleteBtn.textContent = "Delete";
            deleteBtn.onclick = async () => {
              if (confirm("Delete this message?")) {
                try {
                  await deleteDoc(doc(db, "chats", activeChatId, "messages", docSnap.id));
                } catch (e) {
                  alert("Failed to delete message: " + e.message);
                }
              }
            };
            controls.appendChild(deleteBtn);
            msgDiv.appendChild(controls);
          }
          messages.appendChild(msgDiv);
        });
        messages.scrollTop = messages.scrollHeight;
      });
    }

    sendBtn.addEventListener("click", async () => {
      const text = messageInput.value.trim();
      if (!text || !activeChatId) return;
      const me = auth.currentUser;
      if (!me) return;
      await addDoc(collection(db, "chats", activeChatId, "messages"), {
        text,
        senderId: me.uid,
        createdAt: serverTimestamp(),
      });
      messageInput.value = "";

      const chatRef = doc(db, "chats", activeChatId);
      await updateDoc(chatRef, { lastMessage: text, updatedAt: serverTimestamp() });

      const [a, b] = activeChatId.split("_");
      const otherUid = me.uid === a ? b : a;
      await updateDoc(doc(db, "userChats", me.uid, "items", activeChatId), {
        lastMessage: text,
        updatedAt: serverTimestamp(),
      });
      await updateDoc(doc(db, "userChats", otherUid, "items", activeChatId), {
        lastMessage: text,
        updatedAt: serverTimestamp(),
      });
    });

    deleteChatBtn.addEventListener("click", async () => {
      if (!activeChatId) return;
      if (!confirm("Are you sure you want to delete this chat? This action cannot be undone.")) return;
      try {
        const msgsRef = collection(db, "chats", activeChatId, "messages");
        const msgsSnap = await getDocs(msgsRef);
        await Promise.all(msgsSnap.docs.map(d => deleteDoc(d.ref)));
        await deleteDoc(doc(db, "chats", activeChatId));
        const participants = activeChatId.split("_");
        await Promise.all(participants.map(uid => deleteDoc(doc(db, "userChats", uid, "items", activeChatId))));
        messages.innerHTML = "";
        chatTitle.textContent = "No chat selected";
        chatSub.textContent = "";
        composer.style.display = "none";
        deleteChatBtn.style.display = "none";
        emptyState.style.display = "block";
        activeChatId = null;
      } catch (e) {
        alert("Error deleting chat: " + e.message);
      }
    });

    inviteBtn.addEventListener("click", () => {
      const url = location.href;
      location.href = `mailto:?subject=Join me on Chatter&body=Let‚Äôs chat here: ${url}`;
    });

    function debounce(fn, ms) {
      let timer;
      return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => fn(...args), ms);
      };
    }

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, s => ({
        '&': "&amp;",
        '<': "&lt;",
        '>': "&gt;",
        '"': "&quot;",
        "'": "&#39;",
      })[s]);
    }

    function timeAgo(d) {
      const now = new Date();
      const diff = Math.floor((now - d) / 1000);
      if (diff < 60) return diff + "s";
      if (diff < 3600) return Math.floor(diff / 60) + "m";
      if (diff < 86400) return Math.floor(diff / 3600) + "h";
      return Math.floor(diff / 86400) + "d";
    }
  </script>
</body>

</html>


